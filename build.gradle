plugins {
	id "com.replaymod.preprocess" version "897c4096e2"
	id 'fabric-loom' version '1.0-SNAPSHOT' apply false
	id 'io.github.juuxel.loom-quiltflower' version '1.7.0' apply false
}

preprocess {
	def mc117 = createNode("1.17.1", 1_17_01, "yarn")
	def mc118 = createNode("1.18.2", 1_18_02, "yarn")
	def mc119 = createNode("1.19.2", 1_19_02, "yarn")
	def mc1190 = createNode("1.19", 1_19_00, "yarn")
	mc119.link(mc117, file("versions/mapping-1.17.txt"))
	mc119.link(mc118, file("versions/mapping-1.18.txt"))
	mc119.link(mc1190, file("versions/mapping-default.txt"))
}


task buildAndGather {
	subprojects {
		dependsOn project.name + ":build"
	}
	doFirst {
		println "Gathering builds"
		copy {
			subprojects {
				def libDir = project.projectDir.toPath().resolve("build/libs")
				from(libDir) {
					include "*.jar"
					exclude "*-dev.jar", "*-sources.jar", "*-all.jar"
				}
				into "build/libs/"
				duplicatesStrategy DuplicatesStrategy.INCLUDE
			}
		}
	}
}

task publishToMavenLocalGather {
	subprojects {
		dependsOn project.name + ":publishToMavenLocal"
	}
	doFirst {
		copy {
			subprojects {
				def dir = project.projectDir.listFiles()[0]
				println(dir)
				def p = project.projectDir.parentFile.toPath().resolve(dir.getName())
				println(p)
				from(dir)
				into p
				duplicatesStrategy DuplicatesStrategy.INCLUDE
			}
		}
	}
}
